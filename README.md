# Loan-api

## Требования

- Docker, Docker-Compose
- Make
- Git

## Запуск сервиса

#### 1. Клонируем репозиторий сервиса и переходим в создавшуюся директорию.
```
git clone https://github.com/IvanIvanchenko/loan-api.git && cd loan-api
```

#### 2. Копируем файлы окружения и настраиваем.
```
make setup
```

Файл .env должен содержать следующие переменные:

```
SERVER_PORT - порт на котором будет запущен сервис
```
Также нужно прописать UID и GID вашего пользователя

Это нужно чтобы внтури докер-контейнера php действовал тот же пользователь что и "снаружи". Иначе будут проблемы с правами в разных местах.

Получаем свои UID и GID набрав в консоли:
```
$ id -u
1000
$ id -g
1000
```
Проставляем их в .env:
```
UID=1000
GID=1000
```

#### 3. Запускаем проект в докере
```
make start
```

#### 4. При запуске приложения в первый раз нужно проставить ключ приложения (в .env файле константа APP_KEY) и установить зависимости с помощью команды
```
make laravel-setup
```

#### 5. При запуске приложения в первый раз нужно запустить скрипты миграций
```
make laravel-migrate
```

## Настройка Sentry

В файл .env добавить ключ для переменной:
```
SENTRY_LARAVEL_DSN - ключ для отправки данных Sentry
```
Отправка тестового сообщения
```
make test-sentry
```

## Константы
- SERVER_PORT - порт контейнера nginx. По нему будет работать сервис.
- UID - UID пользователя от которого будут работать различные процессы внутри php контейнера, должен совпадать с UID пользователя, от имени которого разворачивается и запускается сервис
- GID - GID группы пользователя от которого будут работать различные процессы внутри php контейнера, должен совпадать с GID группы пользователя, от имени которого разворачивается и запускается сервис

## Тестирование приложения

#### Запуск тестов 
```
make test-loan
```

#### Запуск PHPCS
```
make test-code-loan
```

## Swagger приложения
```
http://167.71.46.215:25500/api/documentation
```
